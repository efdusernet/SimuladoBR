<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Indicadores</title>
  <style>
    body { margin:0; font-family: system-ui,-apple-system,Segoe UI,Roboto,sans-serif; background:#f8fafc; color:#0f172a; }
    h1 { font-size:1.1rem; margin:16px; font-weight:600; }
    .tabs-bar { background:#1e293b; width:100%; padding:12px 16px; box-sizing:border-box; }
    .tabs { display:flex; gap:8px; flex-wrap:wrap; }
    .tab-btn { background:#1e293b; padding:8px 16px; font-size:0.8rem; border-radius:6px; cursor:pointer; color:#cbd5e1; font-weight:600; line-height:1.2; transition:background .18s,color .18s,box-shadow .18s; position:relative; border:none; }
    .tab-btn:not(:first-child)::before { content:''; position:absolute; left:0; top:20%; bottom:20%; width:1px; background:#475569; pointer-events:none; }
    .tab-btn:hover:not(.active) { background:#334155; }
    .tab-btn:focus-visible { outline:2px solid #3b82f6; outline-offset:2px; }
    .tab-btn.active { background:#3b82f6; color:#fff; box-shadow:0 0 0 1px #3b82f6 inset; }
    .sections { padding:0 16px 24px; }
    .section { display:none; min-height:80px; border:1px dashed #e2e8f0; border-radius:6px; padding:12px; background:#ffffff; }
    .section.active { display:block; }
  </style>
  <style>
    .ov-wrapper{max-width:100%; overflow-x:auto;}
    .ov-grid{display:grid; grid-template-columns:minmax(160px,auto) repeat(10,minmax(80px,1fr)); border:1px solid #e2e8f0;}
    .cell{padding:10px 5px; box-sizing:border-box; box-shadow:inset -1px 0 0 #e2e8f0, inset 0 -1px 0 #e2e8f0; font-family:inherit; font-size:14px; text-align:center;}
    .rowlabel{text-align:left;}
    .head,.subhead,.colhead{font-weight:normal;}
  </style>
</head>
<body>
  <h1>Indicadores</h1>
  <div class="tabs-bar">
    <div class="tabs" role="tablist" aria-label="Categorias de Indicadores">
      <button class="tab-btn active" data-tab="geral" role="tab" aria-selected="true">Visão Geral</button>
      <button class="tab-btn" data-tab="grupos" role="tab" aria-selected="false">Grupo Processos</button>
      <button class="tab-btn" data-tab="topico" role="tab" aria-selected="false">Tópico</button>
      <button class="tab-btn" data-tab="abordagem" role="tab" aria-selected="false">Abordagem</button>
    </div>
  </div>
  <div class="sections">
    <section id="sec-geral" class="section active" aria-labelledby="tab-geral">
      <div class="ov-wrapper">
        <div class="ov-grid">
          <div class="cell rowlabel"></div>
          <div class="cell head" style="grid-column: span 5;">Últimos 15 dias</div>
          <div class="cell head" style="grid-column: span 5;">Últimos&nbsp;&nbsp;&nbsp;30 dias</div>

          <div class="cell rowlabel"></div>
          <div class="cell subhead" style="grid-column: span 3;">Você</div>
          <div class="cell subhead" style="grid-column: span 2;">Outros candidatos</div>
          <div class="cell subhead" style="grid-column: span 3;">Você</div>
          <div class="cell subhead" style="grid-column: span 2;">Outros candidatos</div>

          <div class="cell rowlabel"></div>
          <div class="cell colhead">Total</div>
          <div class="cell colhead">Aprovado</div>
          <div class="cell colhead">Reprovado</div>
          <div class="cell colhead">Aprovado</div>
          <div class="cell colhead">Reprovado</div>
          <div class="cell colhead">Total</div>
          <div class="cell colhead">Aprovado</div>
          <div class="cell colhead">Reprovado</div>
          <div class="cell colhead">Aprovado</div>
          <div class="cell colhead">Reprovado</div>

          <div class="cell rowlabel">Exames realizados</div>
          <div class="cell" data-key="last15.you.total">&nbsp;</div>
          <div class="cell" data-key="last15.you.aprovado">&nbsp;</div>
          <div class="cell" data-key="last15.you.reprovado">&nbsp;</div>
          <div class="cell" data-key="last15.others.aprovado">&nbsp;</div>
          <div class="cell" data-key="last15.others.reprovado">&nbsp;</div>
          <div class="cell" data-key="last30.you.total">&nbsp;</div>
          <div class="cell" data-key="last30.you.aprovado">&nbsp;</div>
          <div class="cell" data-key="last30.you.reprovado">&nbsp;</div>
          <div class="cell" data-key="last30.others.aprovado">&nbsp;</div>
          <div class="cell" data-key="last30.others.reprovado">&nbsp;</div>

          <div class="cell rowlabel">Quis&nbsp;&nbsp;&nbsp;realizados</div>
          <div class="cell" data-key="last15.you.total">&nbsp;</div>
          <div class="cell" data-key="last15.you.aprovado">&nbsp;</div>
          <div class="cell" data-key="last15.you.reprovado">&nbsp;</div>
          <div class="cell" data-key="last15.others.aprovado">&nbsp;</div>
          <div class="cell" data-key="last15.others.reprovado">&nbsp;</div>
          <div class="cell" data-key="last30.you.total">&nbsp;</div>
          <div class="cell" data-key="last30.you.aprovado">&nbsp;</div>
          <div class="cell" data-key="last30.you.reprovado">&nbsp;</div>
          <div class="cell" data-key="last30.others.aprovado">&nbsp;</div>
          <div class="cell" data-key="last30.others.reprovado">&nbsp;</div>
        </div>
      </div>
    </section>
    <section id="sec-grupos" class="section" aria-labelledby="tab-grupos"><!-- vazio --></section>
    <section id="sec-topico" class="section" aria-labelledby="tab-topico"><!-- vazio --></section>
    <section id="sec-abordagem" class="section" aria-labelledby="tab-abordagem"><!-- vazio --></section>
  </div>
  <script>
    const tabButtons = Array.from(document.querySelectorAll('.tab-btn'));
    const sectionsMap = {
      geral: document.getElementById('sec-geral'),
      grupos: document.getElementById('sec-grupos'),
      topico: document.getElementById('sec-topico'),
      abordagem: document.getElementById('sec-abordagem')
    };
    tabButtons.forEach(btn => {
      btn.addEventListener('click', () => {
        const tab = btn.getAttribute('data-tab');
        tabButtons.forEach(b => { b.classList.remove('active'); b.setAttribute('aria-selected','false'); });
        btn.classList.add('active'); btn.setAttribute('aria-selected','true');
        Object.keys(sectionsMap).forEach(k => sectionsMap[k].classList.remove('active'));
        sectionsMap[tab].classList.add('active');
      });
    });
    // Simple helper to build Authorization header from localStorage (JWT)
    function getAuthHeadersLocal(){
      try {
        const tok = localStorage.getItem('jwtToken');
        const typ = localStorage.getItem('jwtTokenType') || 'Bearer';
        return tok ? { Authorization: `${typ} ${tok}` } : {};
      } catch(_) { return {}; }
    }

    // Populate overview grid from /api/indicators/overview (uses JWT if present)
    async function loadOverview(){
      const target = sectionsMap.geral;
      if (!target) return;
      try {
        const headers = { 'Accept': 'application/json', ...getAuthHeadersLocal() };
        const res = await fetch('/api/indicators/overview', { headers });
        if (res.status === 401 || res.status === 403) {
          const note = document.createElement('div');
          note.style.marginTop = '8px';
          note.style.color = '#b91c1c';
          note.textContent = 'Faça login para visualizar seus indicadores.';
          target.appendChild(note);
          return;
        }
        if (!res.ok) return;
        const data = await res.json();
        const cells = target.querySelectorAll('[data-key]');
        const getByPath = (obj, path) => path.split('.').reduce((o,k) => (o && typeof o === 'object') ? o[k] : undefined, obj);
        cells.forEach(c => {
          const key = c.getAttribute('data-key');
          const val = getByPath(data, key);
          if (typeof val !== 'undefined' && val !== null) c.textContent = String(val);
        });
      } catch(_) { /* silent */ }
    }

    // Load overview on page display
    loadOverview();
  </script>
</body>
</html>